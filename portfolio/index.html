<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>컴플라이언스 플로우 검증 - Security Portfolio</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <style>
        body { margin: 0; padding: 0; }
        .scrollbar-thin::-webkit-scrollbar { width: 4px; }
        .scrollbar-thin::-webkit-scrollbar-track { background: #1f2937; }
        .scrollbar-thin::-webkit-scrollbar-thumb { background: #4b5563; border-radius: 2px; }
    </style>
</head>
<body>
    <div id="root"></div>
    
    <script type="text/babel">
        const { useState, useRef } = React;

        function ComplianceFlowPortfolio() {
            const [currentScreen, setCurrentScreen] = useState(0);
            const [selectedElement, setSelectedElement] = useState(null);
            const [highlightedLaw, setHighlightedLaw] = useState(null);
            const [checkboxStates, setCheckboxStates] = useState({});
            const [violations, setViolations] = useState([]);
            const lawRefs = useRef({});

            const screens = [
                {
                    id: 'consent',
                    title: '약관동의',
                    elements: [
                        { id: 'all-agree', label: '전체동의 (선택항목 포함)', type: 'checkbox', laws: ['law-22'], required: false, isAllAgree: true },
                        { id: 'required-1', label: '[필수] 개인정보 수집·이용 동의', type: 'checkbox', laws: ['law-15', 'law-22'], required: true },
                        { id: 'required-2', label: '[필수] 고유식별정보 처리 동의', type: 'checkbox', laws: ['law-24'], required: true },
                        { id: 'optional-1', label: '[선택] 마케팅 정보 수신 동의', type: 'checkbox', laws: ['law-50'], required: false }
                    ],
                    button: '동의하고 계속하기'
                },
                {
                    id: 'identity',
                    title: '본인인증',
                    elements: [
                        { id: 'name', label: '이름', type: 'input', placeholder: '홍길동', laws: ['law-15'], required: true },
                        { id: 'ssn', label: '주민등록번호', type: 'input', placeholder: '900101 - 1******', laws: ['law-24', 'law-24-2'], required: true },
                        { id: 'carrier', label: '통신사', type: 'select', placeholder: 'SKT / KT / LG U+', laws: ['law-32'], required: true },
                        { id: 'phone', label: '휴대폰번호', type: 'input', placeholder: '010-1234-5678', laws: ['law-15'], required: true }
                    ],
                    button: '인증번호 요청'
                },
                {
                    id: 'otp',
                    title: '인증번호 확인',
                    elements: [
                        { id: 'otp-input', label: '인증번호 6자리', type: 'otp', placeholder: '● ● ● ● ● ●', laws: ['law-23-3', 'law-29'], required: true },
                        { id: 'timer', label: '남은시간', type: 'timer', placeholder: '03:00', laws: ['law-29'], required: false },
                        { id: 'resend', label: '인증번호 재전송', type: 'link', laws: ['law-29'], required: false }
                    ],
                    button: '인증완료'
                },
                {
                    id: 'complete',
                    title: '인증완료',
                    elements: [
                        { id: 'result-name', label: '이름', type: 'result', placeholder: '홍**', laws: ['law-30'], required: false },
                        { id: 'result-birth', label: '생년월일', type: 'result', placeholder: '1990.**.**', laws: ['law-30'], required: false },
                        { id: 'result-phone', label: '휴대폰', type: 'result', placeholder: '010-****-5678', laws: ['law-30', 'law-21'], required: false }
                    ],
                    button: '확인'
                }
            ];

            const laws = {
                'law-15': {
                    id: 'law-15',
                    title: '개인정보보호법 제15조',
                    subtitle: '개인정보의 수집·이용',
                    description: '개인정보처리자는 정보주체의 동의를 받은 경우 개인정보를 수집할 수 있으며, 그 수집 목적의 범위에서 이용할 수 있다.',
                    checkpoints: ['수집 목적 명시 여부', '수집 항목 고지 여부', '보유기간 안내 여부'],
                    violationText: '개인정보 수집·이용 동의 없이 정보를 수집하는 것은 위법입니다.'
                },
                'law-22': {
                    id: 'law-22',
                    title: '개인정보보호법 제22조',
                    subtitle: '동의를 받는 방법',
                    description: '개인정보처리자는 동의를 받을 때에는 각각의 동의 사항을 구분하여 정보주체가 이를 명확하게 인지할 수 있도록 알리고 각각 동의를 받아야 한다.',
                    checkpoints: ['필수/선택 동의 분리', '개별 동의 획득 방식', '동의 거부권 안내'],
                    violationText: '동의 사항을 구분하지 않고 일괄 동의를 받는 것은 위법입니다.'
                },
                'law-24': {
                    id: 'law-24',
                    title: '개인정보보호법 제24조',
                    subtitle: '고유식별정보의 처리 제한',
                    description: '개인정보처리자는 법령에서 구체적으로 고유식별정보의 처리를 요구하거나 허용하는 경우에 고유식별정보를 처리할 수 있다.',
                    checkpoints: ['처리 법적 근거 확인', '별도 동의 획득 여부', '암호화 조치 여부'],
                    violationText: '고유식별정보 처리 동의 없이 주민번호를 수집하는 것은 위법입니다.'
                },
                'law-24-2': {
                    id: 'law-24-2',
                    title: '개인정보보호법 제24조의2',
                    subtitle: '주민등록번호 처리의 제한',
                    description: '개인정보처리자는 법령에서 구체적으로 주민등록번호의 처리를 요구하거나 허용한 경우를 제외하고는 주민등록번호를 처리할 수 없다.',
                    checkpoints: ['법적 처리 근거 존재', '대체수단 검토 여부', '최소 수집 원칙 준수'],
                    violationText: '법적 근거 없이 주민등록번호를 수집하는 것은 위법입니다.'
                },
                'law-50': {
                    id: 'law-50',
                    title: '정보통신망법 제50조',
                    subtitle: '영리목적의 광고성 정보 전송 제한',
                    description: '누구든지 전자적 전송매체를 이용하여 영리목적의 광고성 정보를 전송하려면 그 수신자의 명시적인 사전 동의를 받아야 한다.',
                    checkpoints: ['사전 동의 획득 여부', '수신거부 방법 안내', '발신자 정보 표시'],
                    violationText: '마케팅 동의 없이 광고성 정보를 전송하는 것은 위법입니다.'
                },
                'law-32': {
                    id: 'law-32',
                    title: '신용정보법 제32조',
                    subtitle: '본인확인기관',
                    description: '본인확인기관은 본인확인서비스를 제공하기 위하여 개인정보를 수집·이용할 수 있다.',
                    checkpoints: ['본인확인기관 지정 여부', 'CI/DI 생성 및 관리', '본인확인 결과 전송'],
                    violationText: '지정되지 않은 기관이 본인확인 서비스를 제공하는 것은 위법입니다.'
                },
                'law-23-3': {
                    id: 'law-23-3',
                    title: '정보통신망법 제23조의3',
                    subtitle: '본인확인기관의 지정 등',
                    description: '방송통신위원회는 정보통신서비스 제공자의 본인확인업무를 지원하기 위하여 본인확인기관을 지정할 수 있다.',
                    checkpoints: ['지정된 기관 사용 여부', '인증 유효시간 설정', '인증정보 암호화 전송'],
                    violationText: '인증 유효시간을 설정하지 않는 것은 보안 위반입니다.'
                },
                'law-29': {
                    id: 'law-29',
                    title: '개인정보보호법 제29조',
                    subtitle: '안전조치의무',
                    description: '개인정보처리자는 개인정보가 분실·도난·유출·위조·변조 또는 훼손되지 아니하도록 안전성 확보에 필요한 기술적·관리적 및 물리적 조치를 하여야 한다.',
                    checkpoints: ['인증정보 암호화', '접근권한 관리', '접속기록 보관'],
                    violationText: '안전조치 없이 개인정보를 처리하는 것은 위법입니다.'
                },
                'law-21': {
                    id: 'law-21',
                    title: '개인정보보호법 제21조',
                    subtitle: '개인정보의 파기',
                    description: '개인정보처리자는 보유기간의 경과, 개인정보의 처리 목적 달성 등 그 개인정보가 불필요하게 되었을 때에는 지체 없이 그 개인정보를 파기하여야 한다.',
                    checkpoints: ['목적 달성 후 즉시 파기', '파기 방법 적정성', '파기 기록 관리'],
                    violationText: '목적 달성 후 개인정보를 파기하지 않는 것은 위법입니다.'
                },
                'law-30': {
                    id: 'law-30',
                    title: '개인정보보호법 제30조',
                    subtitle: '개인정보 처리방침의 수립 및 공개',
                    description: '개인정보처리자는 개인정보의 처리 목적, 처리 및 보유 기간, 제3자 제공에 관한 사항 등을 포함한 개인정보 처리방침을 정하여야 한다.',
                    checkpoints: ['마스킹 처리 적용', '최소 정보 표시', '처리방침 공개'],
                    violationText: '개인정보 처리방침을 공개하지 않는 것은 위법입니다.'
                }
            };

            const currentScreenData = screens[currentScreen];
            const requiredElements = currentScreenData.elements.filter(el => el.required && el.type === 'checkbox');
            const allRequiredChecked = requiredElements.every(el => checkboxStates[el.id]);

            const handleCheckboxToggle = (element) => {
                if (element.isAllAgree) {
                    const newState = !checkboxStates[element.id];
                    const newCheckboxStates = { ...checkboxStates };
                    currentScreenData.elements.forEach(el => {
                        if (el.type === 'checkbox') {
                            newCheckboxStates[el.id] = newState;
                        }
                    });
                    setCheckboxStates(newCheckboxStates);
                } else {
                    const newState = !checkboxStates[element.id];
                    setCheckboxStates(prev => ({ ...prev, [element.id]: newState }));
                    
                    const allAgreeElement = currentScreenData.elements.find(el => el.isAllAgree);
                    if (allAgreeElement) {
                        const otherCheckboxes = currentScreenData.elements.filter(el => el.type === 'checkbox' && !el.isAllAgree);
                        const allOthersChecked = otherCheckboxes.every(el => 
                            el.id === element.id ? newState : checkboxStates[el.id]
                        );
                        setCheckboxStates(prev => ({ ...prev, [allAgreeElement.id]: allOthersChecked }));
                    }
                }
            };

            const handleElementClick = (element) => {
                setSelectedElement(element.id);
                setHighlightedLaw(element.laws);
                
                if (element.laws && element.laws.length > 0) {
                    const firstLawId = element.laws[0];
                    if (lawRefs.current[firstLawId]) {
                        lawRefs.current[firstLawId].scrollIntoView({ 
                            behavior: 'smooth', 
                            block: 'center' 
                        });
                    }
                }

                if (element.type === 'checkbox' && element.required && !checkboxStates[element.id]) {
                    const violationLaws = element.laws.map(lawId => ({
                        ...laws[lawId],
                        elementLabel: element.label
                    }));
                    setViolations(violationLaws);
                } else {
                    setViolations([]);
                }
            };

            const handleNextScreen = () => {
                if (currentScreen === 0 && !allRequiredChecked) {
                    const uncheckedRequired = requiredElements.filter(el => !checkboxStates[el.id]);
                    const violationLaws = uncheckedRequired.flatMap(el => 
                        el.laws.map(lawId => ({
                            ...laws[lawId],
                            elementLabel: el.label
                        }))
                    );
                    setViolations(violationLaws);
                    return;
                }
                
                if (currentScreen < screens.length - 1) {
                    setCurrentScreen(prev => prev + 1);
                    setSelectedElement(null);
                    setHighlightedLaw(null);
                    setViolations([]);
                }
            };

            const currentLaws = [...new Set(currentScreenData.elements.flatMap(el => el.laws))];

            return (
                <div className="h-screen bg-gray-900 text-white flex flex-col overflow-hidden">
                    {/* Header */}
                    <div className="p-4 border-b border-gray-800 flex-shrink-0">
                        <div className="flex items-center justify-between">
                            <div>
                                <h1 className="text-lg md:text-xl font-bold text-white">
                                    본인인증 앱 컴플라이언스 검증
                                </h1>
                                <p className="text-gray-400 text-xs">K사 개인정보보호법 보안 검증 프로젝트</p>
                            </div>
                            
                            <div className="flex items-center gap-1">
                                {screens.map((screen, index) => (
                                    <React.Fragment key={screen.id}>
                                        <button
                                            onClick={() => { 
                                                setCurrentScreen(index); 
                                                setSelectedElement(null); 
                                                setHighlightedLaw(null);
                                                setViolations([]);
                                            }}
                                            className={`px-2 py-1 rounded text-xs font-medium transition-all ${
                                                currentScreen === index
                                                    ? 'bg-blue-600 text-white'
                                                    : 'bg-gray-800 text-gray-400 hover:bg-gray-700'
                                            }`}
                                        >
                                            {screen.title}
                                        </button>
                                        {index < screens.length - 1 && (
                                            <svg className="w-3 h-3 text-gray-600" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 5l7 7-7 7" />
                                            </svg>
                                        )}
                                    </React.Fragment>
                                ))}
                            </div>
                        </div>
                    </div>

                    {/* Main Content */}
                    <div className="flex-1 grid grid-cols-1 lg:grid-cols-2 gap-0 overflow-hidden">
                        {/* Left Panel - App Wireframe */}
                        <div className="bg-gray-850 p-4 flex flex-col border-r border-gray-800 overflow-hidden">
                            <div className="text-xs text-gray-400 mb-2 flex-shrink-0">앱 화면</div>
                            
                            <div className="bg-gray-900 rounded-2xl p-3 max-w-xs mx-auto border-2 border-gray-700 flex-1 flex flex-col overflow-hidden">
                                <div className="flex justify-between text-xs text-gray-500 mb-2 px-1 flex-shrink-0">
                                    <span>9:41</span>
                                    <span>●●●</span>
                                </div>
                                
                                <div className="bg-gray-800 rounded-lg p-2 mb-2 text-center flex-shrink-0">
                                    <span className="font-medium text-sm">{currentScreenData.title}</span>
                                </div>

                                <div className="space-y-2 flex-1 overflow-y-auto scrollbar-thin">
                                    {currentScreen === 3 && (
                                        <div className="flex justify-center mb-2">
                                            <div className="w-10 h-10 bg-green-500 rounded-full flex items-center justify-center">
                                                <svg className="w-5 h-5 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={3} d="M5 13l4 4L19 7" />
                                                </svg>
                                            </div>
                                        </div>
                                    )}
                                    
                                    {currentScreenData.elements.map((element) => (
                                        <div
                                            key={element.id}
                                            onClick={() => {
                                                handleElementClick(element);
                                                if (element.type === 'checkbox') {
                                                    handleCheckboxToggle(element);
                                                }
                                            }}
                                            className={`p-2 rounded-lg cursor-pointer transition-all ${
                                                selectedElement === element.id
                                                    ? 'bg-blue-600 bg-opacity-30 border-2 border-blue-500'
                                                    : 'bg-gray-800 hover:bg-gray-700 border-2 border-transparent'
                                            } ${element.required && !checkboxStates[element.id] && element.type === 'checkbox' ? 'border-l-2 border-l-red-500' : ''}`}
                                        >
                                            {element.type === 'checkbox' && (
                                                <div className="flex items-center gap-2">
                                                    <div className={`w-4 h-4 rounded border-2 flex items-center justify-center flex-shrink-0 transition-colors ${
                                                        checkboxStates[element.id] 
                                                            ? 'border-blue-500 bg-blue-500' 
                                                            : element.required 
                                                                ? 'border-red-400' 
                                                                : 'border-gray-500'
                                                    }`}>
                                                        {checkboxStates[element.id] && (
                                                            <svg className="w-3 h-3 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                                                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={3} d="M5 13l4 4L19 7" />
                                                            </svg>
                                                        )}
                                                    </div>
                                                    <span className={`text-xs ${element.required && !checkboxStates[element.id] ? 'text-red-300' : ''}`}>
                                                        {element.label}
                                                    </span>
                                                </div>
                                            )}
                                            
                                            {(element.type === 'input' || element.type === 'select') && (
                                                <div>
                                                    <div className="text-xs text-gray-400 mb-0.5">{element.label}</div>
                                                    <div className="text-xs text-gray-500">{element.placeholder}</div>
                                                </div>
                                            )}
                                            
                                            {element.type === 'otp' && (
                                                <div className="text-center">
                                                    <div className="text-xs text-gray-400 mb-1">{element.label}</div>
                                                    <div className="text-lg tracking-widest text-gray-500">{element.placeholder}</div>
                                                </div>
                                            )}
                                            
                                            {element.type === 'timer' && (
                                                <div className="text-center">
                                                    <div className="text-xs text-gray-400">{element.label}</div>
                                                    <div className="text-base text-red-400 font-mono">{element.placeholder}</div>
                                                </div>
                                            )}
                                            
                                            {element.type === 'link' && (
                                                <div className="text-center">
                                                    <span className="text-xs text-blue-400 underline">{element.label}</span>
                                                </div>
                                            )}
                                            
                                            {element.type === 'result' && (
                                                <div className="flex justify-between">
                                                    <span className="text-xs text-gray-400">{element.label}</span>
                                                    <span className="text-xs font-medium">{element.placeholder}</span>
                                                </div>
                                            )}
                                        </div>
                                    ))}
                                </div>

                                <button 
                                    onClick={handleNextScreen}
                                    disabled={currentScreen === 0 && !allRequiredChecked}
                                    className={`w-full rounded-lg py-2 mt-2 text-sm font-medium transition-colors flex-shrink-0 ${
                                        currentScreen === 0 && !allRequiredChecked
                                            ? 'bg-gray-600 text-gray-400 cursor-not-allowed'
                                            : 'bg-blue-600 text-white hover:bg-blue-700'
                                    }`}
                                >
                                    {currentScreenData.button}
                                </button>
                                
                                <div className="flex justify-center mt-2 flex-shrink-0">
                                    <div className="w-20 h-1 bg-gray-600 rounded-full"></div>
                                </div>
                            </div>
                            
                            {currentScreen === 0 && !allRequiredChecked && (
                                <div className="mt-2 text-center text-xs text-red-400">
                                    필수 항목에 동의해야 다음으로 넘어갈 수 있습니다
                                </div>
                            )}
                        </div>

                        {/* Right Panel - Legal References */}
                        <div className="bg-gray-800 p-4 flex flex-col overflow-hidden">
                            <div className="text-xs text-gray-400 mb-2 flex-shrink-0">법적 근거</div>
                            
                            {violations.length > 0 && (
                                <div className="mb-3 p-3 bg-red-900 bg-opacity-50 border border-red-500 rounded-lg flex-shrink-0">
                                    <div className="flex items-center gap-2 mb-2">
                                        <svg className="w-4 h-4 text-red-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                            <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" />
                                        </svg>
                                        <span className="text-sm font-medium text-red-300">위법사항 경고</span>
                                    </div>
                                    {violations.map((violation, idx) => (
                                        <div key={idx} className="text-xs text-red-200 mb-1">
                                            <span className="font-medium">{violation.title}:</span> {violation.violationText}
                                        </div>
                                    ))}
                                </div>
                            )}
                            
                            <div className="space-y-3 overflow-y-auto flex-1 scrollbar-thin">
                                {currentLaws.map((lawId) => {
                                    const law = laws[lawId];
                                    const isHighlighted = highlightedLaw && highlightedLaw.includes(lawId);
                                    
                                    return (
                                        <div
                                            key={lawId}
                                            ref={el => lawRefs.current[lawId] = el}
                                            className={`p-3 rounded-lg transition-all ${
                                                isHighlighted
                                                    ? 'bg-blue-600 bg-opacity-30 border-2 border-blue-500'
                                                    : 'bg-gray-900 border-2 border-transparent'
                                            }`}
                                        >
                                            <div className="flex items-start justify-between mb-2">
                                                <div>
                                                    <h3 className="font-medium text-white text-sm">{law.title}</h3>
                                                    <p className="text-xs text-gray-400">{law.subtitle}</p>
                                                </div>
                                                {isHighlighted && (
                                                    <span className="px-1.5 py-0.5 bg-blue-600 rounded text-xs">적용</span>
                                                )}
                                            </div>
                                            
                                            <p className="text-xs text-gray-300 mb-2 leading-relaxed">
                                                {law.description}
                                            </p>
                                            
                                            <div className="border-t border-gray-700 pt-2">
                                                <div className="text-xs text-gray-400 mb-1">검증 체크포인트</div>
                                                <div className="space-y-0.5">
                                                    {law.checkpoints.map((checkpoint, idx) => (
                                                        <div key={idx} className="flex items-center gap-1.5 text-xs">
                                                            <span className="text-green-400">✓</span>
                                                            <span className="text-gray-300">{checkpoint}</span>
                                                        </div>
                                                    ))}
                                                </div>
                                            </div>
                                        </div>
                                    );
                                })}
                            </div>
                        </div>
                    </div>

                    {/* Footer */}
                    <div className="p-2 text-center text-gray-500 text-xs border-t border-gray-800 flex-shrink-0">
                        <p>앱 화면의 요소를 클릭하면 해당 법적 근거가 하이라이트되고 자동 스크롤됩니다</p>
                    </div>
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<ComplianceFlowPortfolio />);
    </script>
</body>
</html>
